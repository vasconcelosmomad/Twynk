import 'dart:async';
import 'package:flutter/material.dart';

// -----------------------------------------------------------------------------
// Cores e Temas (Mantido como antes)
// -----------------------------------------------------------------------------

class TwynkColors {
  static const Color primary = Color(0xFF0EA5E9); // twynk-primary (Sky-500)
  static const Color lightBackground = Color(0xFFF0F9FF); // twynk-light (Um pouco mais claro que o Sky-100 para ser o BG principal)
  static const Color darkBackground = Color(0xFF0F172A); // twynk-dark (Slate-900 para maior contraste)
  static const Color darkSecondary = Color(0xFF1E293B); // Slate-800 para se√ß√µes escuras
  static const Color lightSecondary = Colors.white; // Fundo de se√ß√£o secund√°ria claro
}

 // -----------------------------------------------------------------------------
 // Helpers de tipografia responsiva
 // -----------------------------------------------------------------------------
 double sectionTitleSize(BuildContext context) {
   final double w = MediaQuery.of(context).size.width;
   if (w >= 1024) return 40; // desktop
   if (w >= 600) return 34;  // tablet
   return 28;                 // mobile
 }

 double heroTitleSize(BuildContext context) {
   final double w = MediaQuery.of(context).size.width;
   if (w >= 1280) return 64; // large desktop
   if (w >= 768) return 56;  // desktop/tablet grande
   if (w >= 600) return 48;  // tablet
   return 36;                // mobile
 }

class FAQSection extends StatelessWidget {
  final bool isDark;

  const FAQSection({super.key, required this.isDark});

  @override
  Widget build(BuildContext context) {
    // Swap BG with the CTA style from "Pronto para Brilhar" section
    final Color sectionBg = isDark ? const Color(0xFF162035) : const Color(0xFFE0F2FE);
    final Color titleColor = isDark ? Colors.white : Colors.black87;
    final Color bodyColor = isDark ? Colors.white70 : Colors.black54;

    return Container(
      color: sectionBg,
      padding: const EdgeInsets.symmetric(vertical: 96.0, horizontal: 24.0),
      child: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 900),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.stretch,
            children: [
              Text(
                'üí° Perguntas Frequentes ‚Äî Twynk',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: sectionTitleSize(context),
                  fontWeight: FontWeight.w900,
                  color: titleColor,
                ),
              ),
              const SizedBox(height: 24),

              _faqTile(
                context,
                'Por que n√£o recebi o e-mail com meu ID e senha?',
                'Se voc√™ n√£o receber o e-mail de registro em at√© 10 minutos, verifique sua pasta de spam ou lixo eletr√¥nico, pois alguns provedores podem marcar nossas mensagens incorretamente.\nSe ainda assim n√£o encontrar, tente usar outro endere√ßo de e-mail (por exemplo: Gmail, Yahoo, Outlook, etc.).',
                bodyColor,
              ),
              Divider(height: 1, thickness: 1, color: (isDark ? Colors.white : Colors.black).withOpacity(0.08)),
              _faqTile(
                context,
                'Esqueci minha senha. Como posso redefini-la?',
                'Acesse: https://twynk.app/password\nDigite o e-mail usado no cadastro e clique em ‚ÄúRedefinir minha senha‚Äù.\nVoc√™ receber√° um link para criar uma nova senha.',
                bodyColor,
              ),
              Divider(height: 1, thickness: 1, color: (isDark ? Colors.white : Colors.black).withOpacity(0.08)),
              _faqTile(
                context,
                'Quanto tempo leva para minhas fotos serem aprovadas?\nPor que n√£o consigo enviar uma foto?',
                'A aprova√ß√£o pode levar at√© algumas horas, dependendo do volume de envios.\nSe estiver enfrentando problemas ao enviar fotos, verifique:\n\nPoss√≠veis causas e solu√ß√µes:\nüìÅ Formato n√£o suportado: use apenas JPEG ou PNG.\nüîí Permiss√µes de armazenamento (Android):\nV√° em Configura√ß√µes ‚Üí Aplicativos ‚Üí [Seu navegador ou app Twynk] ‚Üí Permiss√µes ‚Üí Armazenamento ‚Üí Ativar.\nüåê Navegador ou app desatualizado:\nAtualize o Twynk ou tente acessar em outro dispositivo.',
                bodyColor,
              ),
              Divider(height: 1, thickness: 1, color: (isDark ? Colors.white : Colors.black).withOpacity(0.08)),
              _faqTile(
                context,
                'Como ativar ou desativar as notifica√ß√µes por e-mail?',
                'Acesse seu perfil ‚Üí Configura√ß√µes ‚Üí Notifica√ß√µes ‚Üí escolha suas prefer√™ncias para receber (ou n√£o) e-mails sobre novas mensagens, curtidas e conex√µes.',
                bodyColor,
              ),
              Divider(height: 1, thickness: 1, color: (isDark ? Colors.white : Colors.black).withOpacity(0.08)),
              _faqTile(
                context,
                'Como posso excluir meu perfil?\nExclu√≠ minha conta acidentalmente. Posso reativ√°-la?',
                'Para excluir seu perfil, v√° at√© Configura√ß√µes ‚Üí Conta ‚Üí Excluir perfil e siga as instru√ß√µes.\nSe voc√™ excluiu acidentalmente, entre em contato com o suporte antes de 7 dias pelo e-mail: suporte@twynk.app ‚Äî ap√≥s esse prazo, a conta √© removida permanentemente.',
                bodyColor,
              ),
              Divider(height: 1, thickness: 1, color: (isDark ? Colors.white : Colors.black).withOpacity(0.08)),
              _faqTile(
                context,
                'Posso enviar meu e-mail ou n√∫mero de telefone nas mensagens?',
                'Voc√™ pode, mas o Twynk recomenda que s√≥ compartilhe informa√ß√µes pessoais ap√≥s criar confian√ßa com a outra pessoa.\nSua seguran√ßa e privacidade v√™m em primeiro lugar. üíñ',
                bodyColor,
              ),
              Divider(height: 1, thickness: 1, color: (isDark ? Colors.white : Colors.black).withOpacity(0.08)),
              _faqTile(
                context,
                'O Twynk √© gratuito?',
                'Sim! O Twynk pode ser usado gratuitamente para criar conta, conversar e conhecer novas pessoas.\nAl√©m disso, j√° est√° dispon√≠vel o Twynk Premium, que oferece recursos extras como mais visibilidade, envio ilimitado de solicita√ß√µes e destaque no app ‚Äî mas o uso b√°sico continuar√° totalmente gratuito.',
                bodyColor,
              ),
              Divider(height: 1, thickness: 1, color: (isDark ? Colors.white : Colors.black).withOpacity(0.08)),
              _faqTile(
                context,
                'Outra d√∫vida?',
                'Entre em contato com o Suporte Twynk pelo e-mail: suporte@twynk.app ou envie uma mensagem pelo menu Ajuda dentro do aplicativo.',
                bodyColor,
              ),
            ],
          ),
        ),
      ),
    );
  }

  Widget _faqTile(BuildContext context, String title, String content, Color bodyColor) {
    return Theme(
      data: Theme.of(context).copyWith(dividerColor: Colors.transparent),
      child: ExpansionTile(
        backgroundColor: Colors.transparent,
        collapsedBackgroundColor: Colors.transparent,
        tilePadding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
        childrenPadding: const EdgeInsets.fromLTRB(16, 0, 16, 16),
        collapsedIconColor: TwynkColors.primary,
        iconColor: TwynkColors.primary,
        title: Text(
          title,
          style: const TextStyle(fontSize: 18, fontWeight: FontWeight.w700),
        ),
        children: [
          Text(
            content,
            style: TextStyle(fontSize: 16, height: 1.5, color: bodyColor),
          ),
        ],
      ),
    );
  }
}

class _AboutMarqueeRow extends StatefulWidget {
  final List<Widget> items;

  const _AboutMarqueeRow({required this.items});

  @override
  State<_AboutMarqueeRow> createState() => _AboutMarqueeRowState();
}

class _AboutMarqueeRowState extends State<_AboutMarqueeRow> with SingleTickerProviderStateMixin {
  final ScrollController _controller = ScrollController();
  Timer? _timer;

  // pixels per tick = speedPxPerSec * (tickMs/1000)
  static const double _speedPxPerSec = 50; // tune for preferred speed
  static const int _tickMs = 16; // ~60fps

  @override
  void initState() {
    super.initState();
    _start();
  }

  void _start() {
    _timer?.cancel();
    _timer = Timer.periodic(const Duration(milliseconds: _tickMs), (_) {
      if (!_controller.hasClients) return;
      final double delta = _speedPxPerSec * (_tickMs / 1000.0);
      final double max = _controller.position.maxScrollExtent;
      double next = _controller.offset + delta;
      if (next >= max) {
        // reset to start for seamless loop
        _controller.jumpTo(0);
      } else {
        _controller.jumpTo(next);
      }
    });
  }

  @override
  void dispose() {
    _timer?.cancel();
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(
      builder: (context, constraints) {
        // Choose a card width responsive to viewport
        final double maxWidth = constraints.maxWidth;
        double itemWidth = 320;
        if (maxWidth > 1100) itemWidth = 360;
        if (maxWidth < 700) itemWidth = 280;

        final List<Widget> base = widget.items
            .map((w) => SizedBox(width: itemWidth, child: w))
            .toList();
        // Duplicate to allow seamless loop without gap
        final List<Widget> display = [...base, ...base];

        return MouseRegion(
          onEnter: (_) {
            _timer?.cancel();
          },
          onExit: (_) {
            _start();
          },
          child: SizedBox(
            height: 300, // increased to avoid text overflow on narrow widths
            child: ListView.builder(
              controller: _controller,
              scrollDirection: Axis.horizontal,
              clipBehavior: Clip.none,
              physics: const NeverScrollableScrollPhysics(),
              itemCount: display.length,
              itemBuilder: (context, index) {
                return Padding(
                  padding: const EdgeInsets.only(right: 24.0),
                  child: display[index],
                );
              },
            ),
          ),
        );
      },
    );
  }
}

// -----------------------------------------------------------------------------
// Layout Principal (Mantido como antes)
// -----------------------------------------------------------------------------

class WelcomePage extends StatelessWidget {
  final ThemeMode themeMode;
  final Function(bool isDark) onThemeToggle;

  const WelcomePage({
    super.key,
    required this.themeMode,
    required this.onThemeToggle,
  });

  @override
  Widget build(BuildContext context) {
    return TwynkLandingPage(
      themeMode: themeMode,
      onThemeToggle: onThemeToggle,
    );
  }
}

class TwynkLandingPage extends StatelessWidget {
  final ThemeMode themeMode;
  final Function(bool isDark) onThemeToggle;

  TwynkLandingPage({
    super.key,
    required this.themeMode,
    required this.onThemeToggle,
  });

  final GlobalKey heroKey = GlobalKey();
  final GlobalKey aboutKey = GlobalKey();
  final GlobalKey howItWorksKey = GlobalKey();
  final GlobalKey featuresKey = GlobalKey();
  final GlobalKey downloadKey = GlobalKey();

  void scrollToSection(GlobalKey key) {
    if (key.currentContext != null) {
      Scrollable.ensureVisible(
        key.currentContext!,
        duration: const Duration(milliseconds: 700),
        curve: Curves.easeInOutQuad,
      );
    }
  }

  @override
  Widget build(BuildContext context) {
    final bool isDark = themeMode == ThemeMode.dark || (themeMode == ThemeMode.system && Theme.of(context).brightness == Brightness.dark);
    final double screenWidth = MediaQuery.of(context).size.width;
    final bool isDesktop = screenWidth > 768;

    return Theme(
      data: Theme.of(context).copyWith(
        scaffoldBackgroundColor: isDark ? TwynkColors.darkBackground : TwynkColors.lightBackground,
        textTheme: (isDark ? ThemeData.dark() : ThemeData.light()).textTheme.apply(
          bodyColor: isDark ? Colors.white70 : Colors.black87,
          displayColor: isDark ? Colors.white : Colors.black,
        ),
        appBarTheme: AppBarTheme(
          backgroundColor: isDark ? TwynkColors.darkBackground : TwynkColors.lightBackground,
          elevation: 0,
          titleTextStyle: TextStyle(color: isDark ? Colors.white : Colors.black, fontSize: 20, fontWeight: FontWeight.bold),
          iconTheme: IconThemeData(color: TwynkColors.primary),
        ),
      ),
      child: Scaffold(
        appBar: PreferredSize(
          preferredSize: const Size.fromHeight(64.0),
          child: _TwynkAppBar(
            isDesktop: isDesktop,
            isDark: isDark,
            onThemeToggle: onThemeToggle,
            scrollToSection: scrollToSection,
            aboutKey: aboutKey,
            howItWorksKey: howItWorksKey,
            featuresKey: featuresKey,
            downloadKey: downloadKey,
          ),
        ),
        drawer: isDesktop ? null : _TwynkDrawer(
          scrollToSection: scrollToSection,
          aboutKey: aboutKey,
          howItWorksKey: howItWorksKey,
          featuresKey: featuresKey,
          downloadKey: downloadKey,
          isDark: isDark,
        ),
        body: SingleChildScrollView(
          child: Column(
            children: <Widget>[
              _HeroSection(key: heroKey, isDark: isDark),
              _AboutSection(key: aboutKey, isDesktop: isDesktop, isDark: isDark),
              _HowItWorksSection(key: howItWorksKey, isDesktop: isDesktop, isDark: isDark),
              _FeaturesSection(key: featuresKey, isDesktop: isDesktop, isDark: isDark),
              FAQSection(isDark: isDark),
              _DownloadSection(key: downloadKey, isDark: isDark),
              _TwynkFooter(isDark: isDark),
            ],
          ),
        ),
      ),
    );
  }
}

// -----------------------------------------------------------------------------
// AppBar (Cabe√ßalho) (Mantido como antes)
// -----------------------------------------------------------------------------

class _TwynkAppBar extends StatelessWidget {
  final bool isDesktop;
  final bool isDark;
  final Function(bool isDark) onThemeToggle;
  final Function(GlobalKey key) scrollToSection;
  final GlobalKey aboutKey;
  final GlobalKey howItWorksKey;
  final GlobalKey featuresKey;
  final GlobalKey downloadKey;

  const _TwynkAppBar({
    required this.isDesktop,
    required this.isDark,
    required this.onThemeToggle,
    required this.scrollToSection,
    required this.aboutKey,
    required this.howItWorksKey,
    required this.featuresKey,
    required this.downloadKey,
  });

  @override
  Widget build(BuildContext context) {
    return AppBar(
      title: const _TwynkLogo(),
      centerTitle: false,
      titleSpacing: isDesktop ? 64.0 : NavigationToolbar.kMiddleSpacing,
      actions: <Widget>[
        if (isDesktop) ..._buildDesktopNav(context),
        _buildThemeToggleButton(context),
        if (isDesktop) const SizedBox(width: 64) else const SizedBox(width: 12),
      ],
    );
  }

  List<Widget> _buildDesktopNav(BuildContext context) {
    return [
      TextButton(
        onPressed: () => scrollToSection(aboutKey),
        child: Text('Sobre', style: TextStyle(fontWeight: FontWeight.w500, color: Theme.of(context).textTheme.bodyLarge?.color)),
      ),
      TextButton(
        onPressed: () => scrollToSection(howItWorksKey),
        child: Text('Como Funciona', style: TextStyle(fontWeight: FontWeight.w500, color: Theme.of(context).textTheme.bodyLarge?.color)),
      ),
      TextButton(
        onPressed: () => scrollToSection(featuresKey),
        child: Text('Recursos', style: TextStyle(fontWeight: FontWeight.w500, color: Theme.of(context).textTheme.bodyLarge?.color)),
      ),
      TextButton(
        onPressed: () { /* L√≥gica de Login */ },
        child: Text('Login', style: TextStyle(fontWeight: FontWeight.w500, color: Theme.of(context).textTheme.bodyLarge?.color)),
      ),
      Padding(
        padding: const EdgeInsets.symmetric(horizontal: 48.0),
        child: ElevatedButton(
          onPressed: () => scrollToSection(downloadKey),
          style: ElevatedButton.styleFrom(
            backgroundColor: TwynkColors.primary,
            foregroundColor: Colors.white,
            shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(30)),
            elevation: 4,
          ),
          child: const Text('Cadastre-se', style: TextStyle(fontSize: 15, fontWeight: FontWeight.bold)),
        ),
      ),
    ];
  }

  Widget _buildThemeToggleButton(BuildContext context) {
    return IconButton(
      icon: Icon(isDark ? Icons.wb_sunny : Icons.mode_night, color: isDark ? Colors.amber : Colors.black87),
      onPressed: () => onThemeToggle(!isDark),
      tooltip: isDark ? 'Alternar para Tema Claro' : 'Alternar para Tema Escuro',
    );
  }
}

// -----------------------------------------------------------------------------
// Drawer (Menu Mobile) (Mantido como antes)
// -----------------------------------------------------------------------------

class _TwynkDrawer extends StatelessWidget {
  final Function(GlobalKey key) scrollToSection;
  final GlobalKey aboutKey;
  final GlobalKey howItWorksKey;
  final GlobalKey featuresKey;
  final GlobalKey downloadKey;
  final bool isDark;

  const _TwynkDrawer({
    required this.scrollToSection,
    required this.aboutKey,
    required this.howItWorksKey,
    required this.featuresKey,
    required this.downloadKey,
    required this.isDark,
  });

  @override
  Widget build(BuildContext context) {
    final Color drawerBg = isDark ? TwynkColors.darkBackground : TwynkColors.lightBackground;
    return Drawer(
      backgroundColor: drawerBg,
      elevation: 0,
      surfaceTintColor: Colors.transparent,
      child: Theme(
        data: Theme.of(context).copyWith(
          canvasColor: drawerBg,
          scaffoldBackgroundColor: drawerBg,
          colorScheme: Theme.of(context).colorScheme.copyWith(
            surface: drawerBg,
            background: drawerBg,
            surfaceTint: Colors.transparent,
          ),
        ),
        child: Container(
          color: drawerBg,
          child: ListTileTheme(
            tileColor: drawerBg,
            child: ListView(
              padding: EdgeInsets.zero,
              children: <Widget>[
                DrawerHeader(
                  margin: EdgeInsets.zero,
                  decoration: BoxDecoration(
                    color: drawerBg,
                  ),
                  child: Row(
                    children: [
                      Icon(Icons.star_half, color: isDark ? Colors.white : Colors.black87, size: 32),
                      const SizedBox(width: 12),
                      Text(
                        'Twynk App',
                        style: TextStyle(color: isDark ? Colors.white : Colors.black87, fontSize: 24, fontWeight: FontWeight.bold),
                      ),
                    ],
                  ),
                ),
                _buildDrawerItem(context, 'Sobre', aboutKey, icon: Icons.info_outline),
                _buildDrawerItem(context, 'Como Funciona', howItWorksKey, icon: Icons.help_outline),
                _buildDrawerItem(context, 'Recursos', featuresKey, icon: Icons.favorite_border),
                _buildDrawerItem(context, 'Login', null, icon: Icons.login),
                _buildDrawerItem(context, 'Cadastre-se', downloadKey, icon: Icons.app_registration, isPrimary: true),
              ],
            ),
          ),
        ),
      ),
    );
  }

  Widget _buildDrawerItem(BuildContext context, String title, GlobalKey? key, {bool isPrimary = false, required IconData icon}) {
    return Padding(
      padding: const EdgeInsets.symmetric(vertical: 1.0),
      child: ListTile(
        contentPadding: const EdgeInsets.symmetric(horizontal: 14.0),
        dense: true,
        visualDensity: const VisualDensity(horizontal: 0, vertical: -3),
        leading: Icon(
          icon,
          color: isPrimary ? TwynkColors.primary : (isDark ? Colors.white70 : Colors.black54),
        ),
        title: Text(
          title,
          style: TextStyle(
            fontSize: 16,
            fontWeight: FontWeight.w600,
            color: isPrimary ? TwynkColors.primary : (isDark ? Colors.white : Colors.black87),
          ),
        ),
        onTap: () {
          Navigator.pop(context);
          if (key != null) {
            scrollToSection(key);
          }
        },
      ),
    );
  }
}


// -----------------------------------------------------------------------------
// Logo Widget (Mantido como antes)
// -----------------------------------------------------------------------------

class _TwynkLogo extends StatelessWidget {
  const _TwynkLogo();

  @override
  Widget build(BuildContext context) {
    return Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        const Icon(Icons.star_half, color: TwynkColors.primary, size: 30),
        const SizedBox(width: 8),
        Text(
          'Twynk',
          style: TextStyle(
            fontSize: 26,
            fontWeight: FontWeight.w900,
            color: TwynkColors.primary,
            letterSpacing: -0.8,
          ),
        ),
      ],
    );
  }
}

// -----------------------------------------------------------------------------
// Se√ß√£o Hero (COM AJUSTE DE BORDA E SOMBRA 3D NO CARROSSEL)
// -----------------------------------------------------------------------------

class _HeroSection extends StatefulWidget {
  final bool isDark;
  
  const _HeroSection({super.key, required this.isDark});

  @override
  State<_HeroSection> createState() => _HeroSectionState();
}

class _HeroSectionState extends State<_HeroSection> with SingleTickerProviderStateMixin {
  final PageController _pageController = PageController();
  final List<String> _heroImages = [
    'assets/images/hero_01.png',
    'assets/images/hero_02.png',
    'assets/images/hero_03.png',
    'assets/images/hero_04.png',
  ];
  int _currentPage = 0;
  Timer? _timer;

  @override
  void initState() {
    super.initState();
    // Inicia rota√ß√£o autom√°tica das imagens
    _startAutoScroll();
  }

  @override
  void dispose() {
    _timer?.cancel();
    _pageController.dispose();
    super.dispose();
  }

  void _startAutoScroll() {
    _timer = Timer.periodic(const Duration(seconds: 4), (timer) {
      if (!mounted) return;
      setState(() {
        _currentPage = (_currentPage + 1) % (_heroImages.isNotEmpty ? _heroImages.length : 1);
      });
    });
  }

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();
    // Precache hero images to make theme switching smoother
    for (final path in _heroImages) {
      precacheImage(AssetImage(path), context);
    }
  }

  @override
  Widget build(BuildContext context) {
    final double screenWidth = MediaQuery.of(context).size.width;
    final bool isDesktop = screenWidth > 768;
    final bool isTablet = screenWidth > 600 && screenWidth <= 768;

    return Container(
      color: widget.isDark ? TwynkColors.darkSecondary : TwynkColors.lightSecondary, 
      padding: EdgeInsets.symmetric(
        vertical: isDesktop ? 96.0 : 60.0,
        horizontal: isDesktop ? 48.0 : 24.0,
      ),
      child: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 1200),
          child: isDesktop || isTablet
              ? _buildDesktopLayout(context)
              : _buildMobileLayout(context),
        ),
      ),
    );
  }

  Widget _buildDesktopLayout(BuildContext context) {
    return Row(
      crossAxisAlignment: CrossAxisAlignment.center,
      children: [
        Expanded(
          flex: 1,
          child: _buildTextContent(context, TextAlign.left),
        ),
        const SizedBox(width: 64, height: 80),
        Expanded(
          flex: 1,
          child: _buildImageCarousel(context),
        ),
      ],
    );
  }

  Widget _buildMobileLayout(BuildContext context) {
    return Column(
      children: [
        _buildTextContent(context, TextAlign.center),
        const SizedBox(height: 48),
        _buildImageCarousel(context),
      ],
    );
  }

  Widget _buildTextContent(BuildContext context, TextAlign textAlign) {
    final double w = MediaQuery.of(context).size.width;
    final bool isMobile = w <= 600;
    final TextAlign titleAlign = isMobile ? TextAlign.justify : textAlign;

    return Column(
      crossAxisAlignment: textAlign == TextAlign.left
          ? CrossAxisAlignment.start
          : CrossAxisAlignment.center,
      children: [
        Text(
          'Twynk ‚Äî acenda a fa√≠sca, encontre a conex√£o.',
          textAlign: titleAlign,
          style: TextStyle(
            fontSize: heroTitleSize(context),
            fontWeight: FontWeight.w900,
            height: 1.1,
            color: widget.isDark ? Colors.white : Colors.black87,
          ),
        ),
        const SizedBox(height: 20),
        Text(
          'Descubra encontros reais, divirta-se e conecte-se com pessoas que brilham como voc√™. O seu pr√≥ximo crush est√° aqui.',
          textAlign: textAlign,
          style: TextStyle(
            fontSize: MediaQuery.of(context).size.width > 600 ? 22 : 18,
            color: widget.isDark ? Colors.white70 : Colors.black54,
          ),
        ),
        const SizedBox(height: 40),
        if (isMobile)
          Column(
            crossAxisAlignment: CrossAxisAlignment.stretch,
            children: [
              SizedBox(
                width: double.infinity,
                child: ElevatedButton(
                  onPressed: () { /* Baixar Agora */ },
                  style: ElevatedButton.styleFrom(
                    backgroundColor: TwynkColors.primary,
                    foregroundColor: Colors.white,
                    padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 14),
                    shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(30)),
                    elevation: 8,
                  ),
                  child: const Text('Baixar app', style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold)),
                ),
              ),
              const SizedBox(height: 12),
              SizedBox(
                width: double.infinity,
                child: OutlinedButton(
                  onPressed: () { /* Entrar ou Registrar-se */ },
                  style: OutlinedButton.styleFrom(
                    foregroundColor: TwynkColors.primary,
                    side: const BorderSide(color: TwynkColors.primary, width: 1.5),
                    padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 14),
                    shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(30)),
                  ),
                  child: const Text('Entrar ou Registrar-se', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w700)),
                ),
              ),
            ],
          )
        else
          Wrap(
            spacing: 16,
            runSpacing: 16,
            alignment: textAlign == TextAlign.left
                ? WrapAlignment.start
                : WrapAlignment.center,
            children: [
              ElevatedButton(
                onPressed: () { /* Baixar Agora */ },
                style: ElevatedButton.styleFrom(
                  backgroundColor: TwynkColors.primary,
                  foregroundColor: Colors.white,
                  padding: const EdgeInsets.symmetric(horizontal: 40, vertical: 18),
                  shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(30)),
                  elevation: 10,
                ),
                child: const Text('Baixar app', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
              ),
              OutlinedButton(
                onPressed: () { /* Entrar ou Registrar-se */ },
                style: OutlinedButton.styleFrom(
                  foregroundColor: TwynkColors.primary,
                  side: const BorderSide(color: TwynkColors.primary, width: 1.5),
                  padding: const EdgeInsets.symmetric(horizontal: 32, vertical: 18),
                  shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(30)),
                ),
                child: const Text('Entrar ou Registrar-se', style: TextStyle(fontSize: 18, fontWeight: FontWeight.w700)),
              ),
            ],
          ),
      ],
    );
  }

  Widget _buildImageCarousel(BuildContext context) {
    final double carouselHeight = MediaQuery.of(context).size.width > 768 ? 550 : 400;

    final String currentPath = _heroImages.isNotEmpty
      ? _heroImages[_currentPage % _heroImages.length]
      : (widget.isDark ? 'assets/images/hero_02.png' : 'assets/images/hero_01.png');
    final String prevPath = _heroImages.isNotEmpty
        ? _heroImages[(_currentPage - 1 + _heroImages.length) % _heroImages.length]
        : currentPath;
    final String nextPath = _heroImages.isNotEmpty
        ? _heroImages[(_currentPage + 1) % _heroImages.length]
        : currentPath;

  return Container(
    height: carouselHeight,
    decoration: const BoxDecoration(),
    child: Stack(
      alignment: Alignment.center,
      children: [
        // Back-left (previous)
        Transform(
          alignment: Alignment.center,
          transform: Matrix4.identity()
            ..translate(-32.0, 4.0, 0.0)
            ..rotateZ(-0.035)
            ..scale(0.9),
          child: Opacity(
            opacity: 0.5,
            child: ClipRRect(
              borderRadius: BorderRadius.circular(8),
              child: Image.asset(
                prevPath,
                fit: BoxFit.cover,
              ),
            ),
          ),
        ),

        // Back-right (next)
        Transform(
          alignment: Alignment.center,
          transform: Matrix4.identity()
            ..translate(32.0, 4.0, 0.0)
            ..rotateZ(0.035)
            ..scale(0.9),
          child: Opacity(
            opacity: 0.5,
            child: ClipRRect(
              borderRadius: BorderRadius.circular(8),
              child: Image.asset(
                nextPath,
                fit: BoxFit.cover,
              ),
            ),
          ),
        ),

        // Front (current) with shadow, repaint boundary and animation
        Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            boxShadow: [
              BoxShadow(
                color: Colors.black.withOpacity(0.12),
                blurRadius: 24,
                spreadRadius: 0,
                offset: const Offset(0, 12),
              ),
            ],
          ),
          child: RepaintBoundary(
            child: ClipRRect(
              borderRadius: BorderRadius.circular(8),
              child: AnimatedSwitcher(
              duration: const Duration(milliseconds: 600),
              switchInCurve: Curves.easeInOut,
              switchOutCurve: Curves.easeInOut,
              transitionBuilder: (Widget child, Animation<double> animation) {
                final curved = CurvedAnimation(parent: animation, curve: Curves.easeInOut);
                return FadeTransition(
                  opacity: curved,
                  child: SlideTransition(
                    position: Tween<Offset>(begin: const Offset(0.04, 0), end: Offset.zero).animate(curved),
                    child: ScaleTransition(
                      scale: Tween<double>(begin: 0.98, end: 1.0).animate(curved),
                      child: child,
                    ),
                  ),
                );
              },
              child: Image.asset(
                currentPath,
                key: ValueKey(currentPath),
                fit: BoxFit.cover,
                errorBuilder: (context, error, stackTrace) {
                  final fallback = _heroImages.isNotEmpty ? _heroImages.first : currentPath;
                  return Image.asset(
                    fallback,
                    fit: BoxFit.cover,
                    errorBuilder: (context, error, stackTrace) {
                      return Container(
                        color: widget.isDark ? TwynkColors.darkSecondary : TwynkColors.lightBackground,
                        child: Center(
                          child: Icon(
                            Icons.image_not_supported,
                            size: 64,
                            color: widget.isDark ? Colors.white30 : Colors.grey,
                          ),
                        ),
                      );
                    },
                  );
                },
              ),
            ),
          ),
        ),
        ),
      ],
    ),
  );
  }
}

class _AboutSection extends StatelessWidget {
  final bool isDesktop;
  final bool isDark;

  const _AboutSection({super.key, required this.isDesktop, required this.isDark});

  @override
  Widget build(BuildContext context) {
    final Color sectionBg = isDark ? TwynkColors.darkSecondary : Colors.white;

    return Container(
      color: sectionBg,
      padding: const EdgeInsets.symmetric(vertical: 96.0, horizontal: 24.0),
      child: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 1100),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.center,
            children: [
              Text(
                'Sobre o Twynk',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: sectionTitleSize(context),
                  fontWeight: FontWeight.w900,
                  color: isDark ? Colors.white : Colors.black87,
                ),
              ),
              const SizedBox(height: 12),
              Text(
                'O Twynk √© a nova gera√ß√£o dos apps de relacionamento ‚Äî onde as conex√µes acontecem de forma leve, divertida e verdadeira.',
                textAlign: TextAlign.justify,
                style: TextStyle(
                  fontSize: 20,
                  color: isDark ? Colors.white70 : Colors.black54,
                ),
              ),
              const SizedBox(height: 6),
              Text(
                'Inspirado em encontros reais e hist√≥rias aut√™nticas, o Twynk transforma o simples ‚Äúmatch‚Äù em momentos que brilham ‚ú®',
                textAlign: TextAlign.justify,
                style: TextStyle(
                  fontSize: 18,
                  color: isDark ? Colors.white60 : Colors.black45,
                ),
              ),
              const SizedBox(height: 56),

              Builder(builder: (context) {
                final children = [
                  _AboutItem(icon: Icons.favorite_border, title: 'Encontros de verdade, sem complica√ß√µes', description: 'Conhe√ßa pessoas reais, com inten√ß√µes sinceras.\nNo Twynk, o amor acontece naturalmente ‚Äî sem press√£o, sem julgamentos, do seu jeito.', isDark: isDark),
                  _AboutItem(icon: Icons.place_outlined, title: 'Encontre algu√©m perto de voc√™', description: 'Apaixone-se por quem est√° na sua cidade, no seu bairro ou at√© do outro lado do mundo.\nCom o Twynk, a dist√¢ncia deixa de ser um obst√°culo e vira uma oportunidade de conex√£o.', isDark: isDark),
                  _AboutItem(icon: Icons.chat_bubble_outline, title: 'Converse por v√≠deo ou chat', description: 'Crie la√ßos reais com o nosso chat moderno e seguro ‚Äî com ou sem c√¢mera.\nVeja, sorria e converse cara a cara com quem faz seu cora√ß√£o vibrar.', isDark: isDark),
                  _AboutItem(icon: Icons.balance_outlined, title: 'Equil√≠brio e diversidade', description: 'O Twynk √© um espa√ßo para todos ‚Äî aberto, inclusivo e cheio de boas energias.\nAqui, cada conex√£o √© √∫nica e respeitada.', isDark: isDark),
                  _AboutItem(icon: Icons.auto_awesome, title: 'Onde as conex√µes brilham', description: 'Mais do que um app de namoro, o Twynk √© um lugar para fazer parte de algo especial.\nHist√≥rias come√ßam com um clique ‚Äî e continuam com brilho nos olhos.', isDark: isDark),
                  _AboutItemPremium(isDark: isDark),
                ];
                return _AboutMarqueeRow(items: children);
              }),

              const SizedBox(height: 56),

            ],
          ),
        ),
      ),
    );
  }

  Widget _premiumBenefit(String text) {
    return Padding(
      padding: const EdgeInsets.only(top: 6.0),
      child: Row(
        children: [
          const Icon(Icons.check_circle, color: TwynkColors.primary, size: 18),
          const SizedBox(width: 8),
          Expanded(
            child: Text(
              text,
              style: const TextStyle(fontSize: 15),
            ),
          ),
        ],
      ),
    );
  }
}

class _AboutItem extends StatefulWidget {
  final IconData icon;
  final String title;
  final String description;
  final bool isDark;

  const _AboutItem({
    required this.icon,
    required this.title,
    required this.description,
    required this.isDark,
  });

  @override
  State<_AboutItem> createState() => _AboutItemState();
}

class _AboutItemState extends State<_AboutItem> {
  bool _hover = false;

  @override
  Widget build(BuildContext context) {
    return MouseRegion(
      onEnter: (_) => setState(() => _hover = true),
      onExit: (_) => setState(() => _hover = false),
      child: AnimatedScale(
        scale: _hover ? 1.02 : 1.0,
        duration: const Duration(milliseconds: 180),
        curve: Curves.easeOut,
        child: AnimatedContainer(
          duration: const Duration(milliseconds: 200),
          curve: Curves.easeOut,
          padding: const EdgeInsets.all(16),
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(16),
            border: Border.all(
              color: TwynkColors.primary,
              width: _hover ? 2.0 : 1.0,
            ),
            boxShadow: _hover
                ? [
                    BoxShadow(
                      color: TwynkColors.primary.withOpacity(0.15),
                      blurRadius: 18,
                      spreadRadius: 0,
                      offset: const Offset(0, 10),
                    ),
                  ]
                : [],
          ),
          child: Row(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Container(
                width: 44,
                height: 44,
                decoration: BoxDecoration(
                  color: TwynkColors.primary.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(12),
                  border: Border.all(color: TwynkColors.primary.withOpacity(0.5), width: 1.2),
                ),
                alignment: Alignment.center,
                child: Icon(widget.icon, color: TwynkColors.primary, size: 24),
              ),
              const SizedBox(width: 16),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      widget.title,
                      style: TextStyle(
                        fontSize: 20,
                        fontWeight: FontWeight.w800,
                        color: widget.isDark ? Colors.white : Colors.black87,
                      ),
                    ),
                    const SizedBox(height: 6),
                    Text(
                      widget.description,
                      style: TextStyle(
                        fontSize: 16,
                        height: 1.4,
                        color: widget.isDark ? Colors.white70 : Colors.black54,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

class _AboutItemPremium extends StatefulWidget {
  final bool isDark;

  const _AboutItemPremium({required this.isDark});

  @override
  State<_AboutItemPremium> createState() => _AboutItemPremiumState();
}

class _AboutItemPremiumState extends State<_AboutItemPremium> {
  bool _hover = false;

  @override
  Widget build(BuildContext context) {
    return MouseRegion(
      onEnter: (_) => setState(() => _hover = true),
      onExit: (_) => setState(() => _hover = false),
      child: AnimatedScale(
        scale: _hover ? 1.02 : 1.0,
        duration: const Duration(milliseconds: 180),
        curve: Curves.easeOut,
        child: AnimatedContainer(
          duration: const Duration(milliseconds: 200),
          curve: Curves.easeOut,
          padding: const EdgeInsets.all(16),
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(16),
            border: Border.all(
              color: TwynkColors.primary,
              width: _hover ? 2.0 : 1.0,
            ),
            boxShadow: _hover
                ? [
                    BoxShadow(
                      color: TwynkColors.primary.withOpacity(0.15),
                      blurRadius: 18,
                      spreadRadius: 0,
                      offset: const Offset(0, 10),
                    ),
                  ]
                : [],
          ),
          child: Row(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Container(
                width: 44,
                height: 44,
                decoration: BoxDecoration(
                  color: TwynkColors.primary.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(12),
                  border: Border.all(color: TwynkColors.primary.withOpacity(0.5), width: 1.2),
                ),
                alignment: Alignment.center,
                child: const Icon(Icons.workspace_premium, color: TwynkColors.primary, size: 24),
              ),
              const SizedBox(width: 16),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      'Twynk Premium',
                      style: TextStyle(
                        fontSize: 20,
                        fontWeight: FontWeight.w800,
                        color: widget.isDark ? Colors.white : Colors.black87,
                      ),
                    ),
                    const SizedBox(height: 6),
                    Text(
                      'Mensagens ilimitadas, ver quem curtiu voc√™ e destaque nas buscas. Planos Di√°rio, Semanal e Mensal.',
                      style: TextStyle(
                        fontSize: 16,
                        height: 1.4,
                        color: widget.isDark ? Colors.white70 : Colors.black54,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

class _AboutCarouselGrid extends StatefulWidget {
  final List<Widget> items;

  const _AboutCarouselGrid({required this.items});

  @override
  State<_AboutCarouselGrid> createState() => _AboutCarouselGridState();
}

class _AboutCarouselGridState extends State<_AboutCarouselGrid> {
  late final PageController _pageController;
  int _currentPage = 0;
  Timer? _timer;

  List<List<Widget>> _pages = const [];

  @override
  void initState() {
    super.initState();
    _pageController = PageController();
    _buildPages();
    _startAutoScroll();
  }

  void _buildPages() {
    final List<Widget> items = List.of(widget.items);
    _pages = [];
    for (int i = 0; i < items.length; i += 6) {
      _pages.add(items.sublist(i, i + 6 > items.length ? items.length : i + 6));
    }
    if (_pages.isEmpty) {
      _pages = [[]];
    }
  }

  void _startAutoScroll() {
    _timer?.cancel();
    _timer = Timer.periodic(const Duration(seconds: 4), (_) {
      if (!mounted || _pages.isEmpty) return;
      setState(() {
        _currentPage = (_currentPage + 1) % _pages.length;
      });
      if (_pageController.hasClients) {
        _pageController.animateToPage(
          _currentPage,
          duration: const Duration(milliseconds: 500),
          curve: Curves.easeInOut,
        );
      }
    });
  }

  @override
  void didUpdateWidget(covariant _AboutCarouselGrid oldWidget) {
    super.didUpdateWidget(oldWidget);
    if (oldWidget.items != widget.items) {
      _buildPages();
      _currentPage = 0;
      if (_pageController.hasClients) {
        _pageController.jumpToPage(0);
      }
    }
  }

  @override
  void dispose() {
    _timer?.cancel();
    _pageController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(
      builder: (context, constraints) {
        final double maxWidth = constraints.maxWidth;
        final double horizontalGap = 24;
        final double verticalGap = 24;
        final int columns = 3;
        final int rows = 2;
        final double totalHGap = horizontalGap * (columns - 1);
        final double itemWidth = (maxWidth - totalHGap) / columns;
        final double approxItemHeight = 260; // increased further to prevent bottom overflow and show full text
        final double gridHeight = rows * approxItemHeight + verticalGap * (rows - 1);

        return SizedBox(
          width: double.infinity,
          height: gridHeight,
          child: PageView.builder(
            controller: _pageController,
            itemCount: _pages.length,
            padEnds: true,
            itemBuilder: (context, pageIndex) {
              final pageItems = _pages[pageIndex];
              return GridView.builder(
                physics: const NeverScrollableScrollPhysics(),
                gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                  crossAxisCount: columns,
                  mainAxisSpacing: verticalGap,
                  crossAxisSpacing: horizontalGap,
                  childAspectRatio: itemWidth / approxItemHeight,
                ),
                itemCount: pageItems.length,
                itemBuilder: (context, index) {
                  return pageItems[index];
                },
              );
            },
          ),
        );
      },
    );
  }
}

// -----------------------------------------------------------------------------
// Se√ß√£o Como Funciona (Mantido como antes)
// -----------------------------------------------------------------------------

class _HowItWorksSection extends StatelessWidget {
  final bool isDesktop;
  final bool isDark;
  
  const _HowItWorksSection({super.key, required this.isDesktop, required this.isDark});

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.symmetric(vertical: 96.0, horizontal: 24.0),
      child: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 1000),
          child: Column(
            children: [
              Text(
                'Como Funciona',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: sectionTitleSize(context),
                  fontWeight: FontWeight.w900,
                  color: Theme.of(context).textTheme.displayLarge?.color,
                ),
              ),
              const SizedBox(height: 12),
              Text(
                'Come√ßar √© f√°cil. Em apenas tr√™s passos, voc√™ estar√° pronto para encontrar sua conex√£o.',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: 20,
                  color: Theme.of(context).textTheme.bodyMedium?.color?.withOpacity(0.8),
                ),
              ),
              const SizedBox(height: 80),

              LayoutBuilder(
                builder: (context, constraints) {
                  if (isDesktop || constraints.maxWidth > 700) {
                    return Row(
                      mainAxisAlignment: MainAxisAlignment.spaceAround,
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: const [
                        Expanded(child: _HowItWorksStep(number: '01', title: 'Crie seu Perfil', description: 'Mostre sua personalidade. Adicione suas melhores fotos e conte um pouco sobre voc√™.', icon: Icons.person_add_alt_1)),
                        SizedBox(width: 40),
                        Expanded(child: _HowItWorksStep(number: '02', title: 'Deslize e Combine', description: 'Explore perfis e encontre pessoas interessantes. Um deslize para a direita pode ser o in√≠cio de algo novo.', icon: Icons.swipe)),
                        SizedBox(width: 40),
                        Expanded(child: _HowItWorksStep(number: '03', title: 'Inicie a Conversa', description: 'Deu match? N√£o espere! Envie uma mensagem e comece a construir uma conex√£o real.', icon: Icons.chat_bubble_outline)),
                      ],
                    );
                  } else {
                    return Column(
                      children: const [
                        _HowItWorksStep(number: '01', title: 'Crie seu Perfil', description: 'Mostre sua personalidade. Adicione suas melhores fotos e conte um pouco sobre voc√™.', icon: Icons.person_add_alt_1),
                        SizedBox(height: 48),
                        _HowItWorksStep(number: '02', title: 'Deslize e Combine', description: 'Explore perfis e encontre pessoas interessantes. Um deslize para a direita pode ser o in√≠cio de algo novo.', icon: Icons.swipe),
                        SizedBox(height: 48),
                        _HowItWorksStep(number: '03', title: 'Inicie a Conversa', description: 'Deu match? N√£o espere! Envie uma mensagem e comece a construir uma conex√£o real.', icon: Icons.chat_bubble_outline),
                      ],
                    );
                  }
                },
              ),
            ],
          ),
        ),
      ),
    );
  }
}

class _HowItWorksStep extends StatefulWidget {
  final String number;
  final String title;
  final String description;
  final IconData icon;

  const _HowItWorksStep({
    required this.number,
    required this.title,
    required this.description,
    required this.icon,
  });

  @override
  State<_HowItWorksStep> createState() => _HowItWorksStepState();
}

class _HowItWorksStepState extends State<_HowItWorksStep> {
  bool _hover = false;

  @override
  Widget build(BuildContext context) {
    return MouseRegion(
      onEnter: (_) => setState(() => _hover = true),
      onExit: (_) => setState(() => _hover = false),
      child: AnimatedScale(
        scale: _hover ? 1.02 : 1.0,
        duration: const Duration(milliseconds: 180),
        curve: Curves.easeOut,
        child: AnimatedContainer(
          duration: const Duration(milliseconds: 200),
          curve: Curves.easeOut,
          padding: const EdgeInsets.all(16.0),
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(16),
            border: Border.all(
              color: TwynkColors.primary,
              width: _hover ? 2.0 : 1.0,
            ),
            boxShadow: _hover
                ? [
                    BoxShadow(
                      color: TwynkColors.primary.withOpacity(0.15),
                      blurRadius: 18,
                      spreadRadius: 0,
                      offset: const Offset(0, 10),
                    ),
                  ]
                : [],
          ),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Container(
                width: 60,
                height: 60,
                decoration: BoxDecoration(
                  color: TwynkColors.primary.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(12),
                  border: Border.all(color: TwynkColors.primary.withOpacity(0.5), width: 1.5),
                ),
                alignment: Alignment.center,
                child: Icon(widget.icon, color: TwynkColors.primary, size: 32),
              ),
              const SizedBox(height: 24),
              Text(
                widget.title,
                style: TextStyle(
                  fontSize: 24,
                  fontWeight: FontWeight.w700,
                  color: Theme.of(context).textTheme.titleLarge?.color,
                ),
              ),
              const SizedBox(height: 8),
              Text(
                widget.description,
                style: TextStyle(
                  fontSize: 16,
                  color: Theme.of(context).textTheme.bodyMedium?.color?.withOpacity(0.7),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

// -----------------------------------------------------------------------------
// Se√ß√£o de Recursos (Features)
// -----------------------------------------------------------------------------

class _FeaturesSection extends StatelessWidget {
  final bool isDesktop;
  final bool isDark;
  
  const _FeaturesSection({super.key, required this.isDesktop, required this.isDark});

  @override
  Widget build(BuildContext context) {
    final Color sectionBg = isDark ? TwynkColors.darkSecondary : Colors.white;

    return Container(
      color: sectionBg,
      padding: const EdgeInsets.symmetric(vertical: 96.0, horizontal: 24.0),
      child: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 1200),
          child: Column(
            children: [
              Text(
                'Conex√µes que Acontecem',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: sectionTitleSize(context),
                  fontWeight: FontWeight.w900,
                  color: isDark ? Colors.white : Colors.black87,
                ),
              ),
              const SizedBox(height: 12),
              Text(
                'O Twynk foi projetado para ser intuitivo, seguro e focado na sua autenticidade.',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: 20,
                  color: isDark ? Colors.white70 : Colors.black54,
                ),
              ),
              const SizedBox(height: 80),

              LayoutBuilder(
                builder: (context, constraints) {
                  int crossAxisCount = 1;
                  double childAspectRatio = 1.0;
                  double cardHeight = 200;

                  if (isDesktop || constraints.maxWidth > 900) {
                    crossAxisCount = 3;
                    cardHeight = 240;
                  } else if (constraints.maxWidth > 550) {
                    crossAxisCount = 2;
                    cardHeight = 220;
                  }

                  final double totalSpacing = 32.0 * (crossAxisCount - 1);
                  final double itemWidth = (constraints.maxWidth - totalSpacing) / crossAxisCount;
                  childAspectRatio = itemWidth / cardHeight;

                  return GridView.builder(
                    shrinkWrap: true,
                    physics: const NeverScrollableScrollPhysics(),
                    gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                      crossAxisCount: crossAxisCount,
                      crossAxisSpacing: 32,
                      mainAxisSpacing: 32,
                      mainAxisExtent: cardHeight,
                    ),
                    itemCount: 3,
                    itemBuilder: (context, index) {
                      switch (index) {
                        case 0:
                          return _FeatureCard(
                            icon: Icons.flash_on,
                            title: 'Chat Instant√¢neo',
                            description: 'N√£o espere. Converse em tempo real e comece a fa√≠sca com mensagens de texto, √°udio e v√≠deo.',
                            height: cardHeight,
                          );
                        case 1:
                          return _FeatureCard(
                            icon: Icons.verified_user,
                            title: 'Perfis Aut√™nticos',
                            description: 'Verifica√ß√£o de fotos e filtros de interesse detalhados para garantir que voc√™ encontre o que procura.',
                            height: cardHeight,
                          );
                        default:
                          return _FeatureCard(
                            icon: Icons.security,
                            title: 'Seguran√ßa Primeiro',
                            description: 'Ferramentas avan√ßadas de den√∫ncia e modera√ß√£o 24/7 para manter sua experi√™ncia segura e divertida.',
                            height: cardHeight,
                          );
                      }
                    },
                  );
                },
              ),
            ],
          ),
        ),
      ),
    );
  }
}

class _FeatureCard extends StatefulWidget {
  final IconData icon;
  final String title;
  final String description;
  final double height;

  const _FeatureCard({
    required this.icon,
    required this.title,
    required this.description,
    required this.height,
  });

  @override
  State<_FeatureCard> createState() => _FeatureCardState();
}

class _FeatureCardState extends State<_FeatureCard> {
  bool _hover = false;

  @override
  Widget build(BuildContext context) {
    final bool isDark = Theme.of(context).brightness == Brightness.dark;

    return MouseRegion(
      onEnter: (_) => setState(() => _hover = true),
      onExit: (_) => setState(() => _hover = false),
      child: AnimatedScale(
        scale: _hover ? 1.02 : 1.0,
        duration: const Duration(milliseconds: 180),
        curve: Curves.easeOut,
        child: Material(
          elevation: 0,
          color: Colors.transparent,
          shadowColor: Colors.transparent,
          borderRadius: BorderRadius.circular(20),
          animationDuration: Duration.zero,
          child: AnimatedContainer(
            duration: const Duration(milliseconds: 200),
            curve: Curves.easeOut,
            height: widget.height,
            padding: const EdgeInsets.all(16.0),
            decoration: BoxDecoration(
              borderRadius: BorderRadius.circular(20),
              border: Border.all(
                color: TwynkColors.primary,
                width: _hover ? 2.0 : 1.0,
              ),
              boxShadow: _hover
                  ? [
                      BoxShadow(
                        color: TwynkColors.primary.withOpacity(isDark ? 0.20 : 0.15),
                        blurRadius: 20,
                        spreadRadius: 0,
                        offset: const Offset(0, 10),
                      ),
                    ]
                  : [],
            ),
            child: Column(
              mainAxisAlignment: MainAxisAlignment.start,
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Icon(widget.icon, color: TwynkColors.primary, size: 28),
                const SizedBox(height: 8),
                Text(
                  widget.title,
                  maxLines: 1,
                  overflow: TextOverflow.ellipsis,
                  style: TextStyle(
                    fontSize: 18,
                    fontWeight: FontWeight.w800,
                    color: isDark ? Colors.white : Colors.black87,
                  ),
                ),
                const SizedBox(height: 6),
                Flexible(
                  child: Text(
                    widget.description,
                    maxLines: 3,
                    overflow: TextOverflow.ellipsis,
                    style: TextStyle(
                      fontSize: 14,
                      height: 1.4,
                      color: isDark ? Colors.white70 : Colors.black54,
                    ),
                  ),
                )
              ],
            ),
          ),
        ),
      ),
    );
  }
}

// -----------------------------------------------------------------------------
// Se√ß√£o de Download (CTA Final) 
// -----------------------------------------------------------------------------

class _DownloadSection extends StatelessWidget {
  final bool isDark;
  
  const _DownloadSection({super.key, required this.isDark});

  @override
  Widget build(BuildContext context) {
    // Swap BG with the plain section style used previously by FAQ
    final Color ctaBg = isDark ? TwynkColors.darkSecondary : Colors.white;

    return Container(
      color: ctaBg,
      padding: const EdgeInsets.symmetric(vertical: 96.0, horizontal: 24.0),
      child: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 800),
          child: Column(
            children: [
              Text(
                'Pronto para Brilhar?',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: sectionTitleSize(context),
                  fontWeight: FontWeight.w900,
                  color: isDark ? Colors.white : Colors.black87,
                ),
              ),
              const SizedBox(height: 12),
              Text(
                'Milhares de pessoas est√£o esperando para se conectar. Junte-se √† comunidade Twynk hoje!',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: 22,
                  color: isDark ? Colors.white70 : Colors.black54,
                ),
              ),
              const SizedBox(height: 48),
              Wrap(
                spacing: 24,
                runSpacing: 16,
                alignment: WrapAlignment.center,
                children: [
                  _StoreButton(
                    icon: Icons.apple,
                    text: 'App Store',
                    backgroundColor: Colors.black,
                    textColor: Colors.white,
                    onPressed: () { /* Link App Store */ },
                  ),
                  _StoreButton(
                    icon: Icons.android,
                    text: 'Google Play',
                    backgroundColor: Colors.white,
                    textColor: Colors.black,
                    onPressed: () { /* Link Google Play */ },
                  ),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }
}

class _StoreButton extends StatelessWidget {
  final IconData icon;
  final String text;
  final Color backgroundColor;
  final Color textColor;
  final VoidCallback onPressed;

  const _StoreButton({
    required this.icon,
    required this.text,
    required this.backgroundColor,
    required this.textColor,
    required this.onPressed,
  });

  @override
  Widget build(BuildContext context) {
    return ElevatedButton.icon(
      onPressed: onPressed,
      style: ElevatedButton.styleFrom(
        backgroundColor: backgroundColor,
        foregroundColor: textColor,
        padding: const EdgeInsets.symmetric(horizontal: 32, vertical: 16),
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
        elevation: 8,
        side: backgroundColor == Colors.white ? BorderSide(color: Colors.grey.shade300) : null,
      ),
      icon: Icon(icon, size: 28),
      label: Text(text, style: const TextStyle(fontSize: 18, fontWeight: FontWeight.w700)),
    );
  }
}

// -----------------------------------------------------------------------------
// Rodap√© (Footer) 
// -----------------------------------------------------------------------------

class _TwynkFooter extends StatelessWidget {
  final bool isDark;
  
  const _TwynkFooter({required this.isDark});

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.symmetric(vertical: 48.0, horizontal: 24.0),
      decoration: BoxDecoration(
        color: isDark ? TwynkColors.darkBackground : TwynkColors.lightBackground,
        border: Border(
          top: BorderSide(
            color: isDark 
                ? Colors.white.withOpacity(0.1) 
                : Colors.black.withOpacity(0.1),
            width: 1,
          ),
        ),
      ),
      child: Center(
        child: ConstrainedBox(
          constraints: const BoxConstraints(maxWidth: 1200),
          child: Column(
            children: [
              Row(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Icon(
                    Icons.star_half,
                    color: TwynkColors.primary,
                    size: 28,
                  ),
                  const SizedBox(width: 8),
                  Text(
                    'Twynk',
                    style: TextStyle(
                      fontSize: 24,
                      fontWeight: FontWeight.w900,
                      color: TwynkColors.primary,
                      letterSpacing: -0.5,
                    ),
                  ),
                ],
              ),
              const SizedBox(height: 24),
              LayoutBuilder(
                builder: (context, constraints) {
                  final isMobile = constraints.maxWidth < 600;

                  if (isMobile) {
                    return Column(
                      children: [
                        _linkRow(context),
                        const SizedBox(height: 24),
                        _copyrightText(context),
                      ],
                    );
                  } else {
                    return Row(
                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
                      children: [
                        _copyrightText(context),
                        _linkRow(context),
                      ],
                    );
                  }
                },
              ),
            ],
          ),
        ),
      ),
    );
  }

  Widget _copyrightText(BuildContext context) {
    return Text(
      '¬© 2025 Twynk App. Todos os direitos reservados.',
      textAlign: TextAlign.center,
      style: TextStyle(
        color: isDark ? Colors.white54 : Colors.black54,
        fontSize: 14,
      ),
    );
  }

  Widget _linkRow(BuildContext context) {
    return Wrap(
      spacing: 24,
      runSpacing: 8,
      alignment: WrapAlignment.center,
      children: [
        _FooterLink(
          label: 'Termos de Uso',
          onPressed: () { /* Link Termos de Uso */ },
          isDark: isDark,
        ),
        _FooterLink(
          label: 'Pol√≠tica de Privacidade',
          onPressed: () { /* Link Pol√≠tica de Privacidade */ },
          isDark: isDark,
        ),
      ],
    );
  }
}

class _FooterLink extends StatefulWidget {
  final String label;
  final VoidCallback onPressed;
  final bool isDark;

  const _FooterLink({
    required this.label,
    required this.onPressed,
    required this.isDark,
  });

  @override
  State<_FooterLink> createState() => _FooterLinkState();
}

class _FooterLinkState extends State<_FooterLink> {
  bool _isHovered = false;

  @override
  Widget build(BuildContext context) {
    return MouseRegion(
      onEnter: (_) => setState(() => _isHovered = true),
      onExit: (_) => setState(() => _isHovered = false),
      child: TextButton(
        onPressed: widget.onPressed,
        child: AnimatedDefaultTextStyle(
          duration: const Duration(milliseconds: 200),
          style: TextStyle(
            color: _isHovered
                ? TwynkColors.primary
                : (widget.isDark ? Colors.white70 : Colors.black54),
            fontSize: 14,
            fontWeight: FontWeight.w500,
          ),
          child: Text(widget.label),
        ),
      ),
    );
  }
}
